#!/bin/bash
#
# glassfish-<%= @domain_name %>:          Startup script for Glassfish Application Server for <%= @domain_name %> domain.

<% glassfish_home = "#{node[:glassfish][:base_dir]}/glassfish" %>

export AS_JAVA=<%= node["java"]["java_home"] %>

start() {
        echo -n "Starting Glassfish Domain <%= @domain_name %>: "
        <% log_file = "#{glassfish_home}/domains/#{@domain_name}/logs/startup.log" %>
        su <%= node[:glassfish][:user] %> -c "touch <%= log_file %>"
        echo "Starting Glassfish at `date`" >> <%= log_file %>
        su <%= node[:glassfish][:user] %> -c "<%= glassfish_home %>/bin/asadmin start-domain --domaindir <%= node[:glassfish][:domains_dir] %> <%= @domain_name %>" >> <%= log_file %>
        sleep 2
        echo "done"
}

stop() {
        echo -n "Stopping Glassfish Domain <%= @domain_name %>: "
        <% log_file = "#{glassfish_home}/domains/#{@domain_name}/logs/startup.log" %>
        su <%= node[:glassfish][:user] %> -c "touch <%= log_file %>"
        echo "Stopping Glassfish at `date`" >> <%= log_file %>
        su <%= node[:glassfish][:user] %> -c "<%= glassfish_home %>/bin/asadmin stop-domain --domaindir <%= node[:glassfish][:domains_dir] %> <%= @domain_name %>" >> <%= log_file %>
        echo "done"
}

case "$1" in
        start)
                start
                ;;
        stop)
                stop
                ;;
        restart)
                stop
                start
                ;;
        *)
                echo $"Usage: glassfish {start|stop|restart}"
                exit
esac
